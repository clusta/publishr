@{
    Layout = "_Layout.cshtml";
}

<div class="container" ng-app="blogpost">
    <div ui-view></div>

    <script id="Search.html" type="text/ng-template">
        <table class="table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Tasks</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="listing in result.data">
                    <td>{{listing.cards.medium.title}}</td>
                    <td>
                        <a href="#/read/{{listing.id}}" class="btn btn-primary">
                            View
                        </a>
                        <a href="#/update/{{listing.id}}" class="btn btn-default">
                            Edit
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </script>

    <script id="Create.html" type="text/ng-template">
        <form name="form" ng-submit="createPage(form)">
            <h2>Create blog post</h2>
            <div class="form-group">
                <input class="form-control" type="text" placeholder="Path" ng-model="create.path" ng-required />
            </div>
            <div class="form-group">
                <input class="form-control" type="text" placeholder="Heading" ng-model="create.data.regions.main.sections[0].blocks.header.text" ng-required />
            </div>
            <div class="form-group">
                <textarea class="form-control" placeholder="Text" ng-model="create.data.regions.main.sections[0].blocks.content.text" rows="10"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Create</button>
        </form>
    </script>

    <script id="Read.html" type="text/ng-template">
        <div class="row">
            <div class="col-xs-12">
                <h1 class="page-header">{{resource.data.cards.medium.title}}</h1>
            </div>
        </div>
        <div ng-repeat="section in resource.data.regions.main.sections">
            <div class="row">
                <div class="col-xs-12">
                    <h2>{{section.blocks.header.text}}</h2>
                    <p>{{section.blocks.content.text}}</p>
                </div>
            </div>
        </div>
    </script>

    <script id="Update.html" type="text/ng-template">
        <form name="edit" ng-if="resource">
            <div class="row">
                <div class="col-xs-10">
                    <h1>Edit: {{resource.data.cards.medium.title}}</h1>
                    <br />
                </div>
                <div class="col-xs-2">
                    <div class="btn-group pull-right">
                        <a class="btn btn-default" href="#/search">Cancel</a>
                        <button class="btn btn-primary" type="button" ng-click="updatePage(edit)">Save</button>
                    </div>
                </div>
            </div>
            <ul class="nav nav-tabs">
                <li class="disabled"><a>Cards:</a></li>
                <li ng-repeat="(name, card) in resource.data.cards" ng-class="{active: $first}">
                    <a data-target="#card-{{name}}" data-toggle="tab">{{name}}</a>
                </li>
                <li class="disabled"><a>Regions:</a></li>
                <li ng-repeat="(name, region) in resource.data.regions">
                    <a data-target="#region-{{name}}" data-toggle="tab">{{name}}</a>
                </li>
                <li><a data-target="#tags" data-toggle="tab">Tags</a></li>
                <li class="dropdown pull-right">
                    <a class="dropdown-toggle" data-toggle="dropdown">
                        Tasks <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a ng-click="prompt('Card name', addCard)">Add Card</a></li>
                        <li><a ng-click="prompt('Region name', addRegion)">Add Region</a></li>
                    </ul>
                </li>
            </ul>
            <br />
            <div class="tab-content">
                <div ng-repeat="(name, card) in resource.data.cards" class="tab-pane" ng-class="{active: $first}" id="card-{{name}}">
                    <div class="row">
                        <div class="col-xs-1">

                        </div>
                        <div class="col-xs-9">
                            <div class="form-group">
                                <input class="form-control" type="text" placeholder="Title" ng-model="card.title" ng-required />
                            </div>
                            <div class="form-group">
                                <textarea class="form-control" placeholder="Description" ng-model="card.description" rows="5"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="tags">
                    <div class="row">
                        <div class="col-xs-9 col-xs-offset-1">
                            <p class="lead">
                                <span ng-repeat="tag in resource.data.tags">
                                    <span class="label label-default">
                                        {{tag}}
                                        <span class="glyphicon glyphicon-remove" ng-click="removeTag(tag)"></span>
                                    </span>
                                    &nbsp;
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-1">
                            New
                        </div>
                        <div class="col-xs-9">
                            <div class="form-group">
                                <input class="form-control" type="text" placeholder="Tag" ng-model="newTag" />
                            </div>
                        </div>
                        <div class="col-xs-2">
                            <button class="btn btn-default" type="button" ng-click="addTag(newTag);newTag = '';">
                                <span class="glyphicon glyphicon-plus"></span>
                                Add
                            </button>
                        </div>
                    </div>
                </div>
                <div ng-repeat="(name, region) in resource.data.regions" class="tab-pane" id="region-{{name}}">
                    <div ng-repeat="section in region.sections">
                        <div class="row">
                            <div class="col-xs-1">
                                {{$index + 1}}
                            </div>
                            <div class="col-xs-9">
                                <div class="form-group">
                                    <input class="form-control" type="text" placeholder="Title" ng-model="section.blocks.header.text" ng-required />
                                </div>
                                <div class="form-group">
                                    <textarea class="form-control" placeholder="Content" ng-model="section.blocks.content.text" rows="5"></textarea>
                                </div>
                            </div>
                            <div class="col-xs-2">
                                <div ng-show="!$first">
                                    <button type="button" ng-click="moveSectionUp(resource.data.regions.main, section)" class="btn btn-link">
                                        <span class="glyphicon glyphicon-chevron-up"></span>
                                        Move Up
                                    </button>
                                    <br />
                                </div>
                                <div ng-show="!$last">
                                    <button type="button" ng-click="moveSectionDown(resource.data.regions.main, section)" class="btn btn-link">
                                        <span class="glyphicon glyphicon-chevron-down"></span>
                                        Move Down
                                    </button>
                                    <br />
                                </div>
                                <button type="button" ng-click="prompt('Type', addSection, resource.data.regions.main, $index)" class="btn btn-link">
                                    <span class="glyphicon glyphicon-plus"></span>
                                    Add Before
                                </button>
                                <br />
                                <button type="button" ng-click="prompt('Type', addSection, resource.data.regions.main, $index + 1)" class="btn btn-link">
                                    <span class="glyphicon glyphicon-plus"></span>
                                    Add After
                                </button>
                                <br />
                                <button type="button" ng-click="removeSection(resource.data.regions.main, $index)" class="btn btn-link">
                                    <span class="glyphicon glyphicon-remove"></span>
                                    Remove
                                </button>
                            </div>
                        </div>
                        <hr ng-show="!$last" />
                    </div>
                    <div class="well" ng-if="resource.data.regions.main.sections.length == 0">
                        <button type="button" ng-click="addSection()">Add first section</button>
                    </div>
                </div>
            </div>
        </form>
    </script>
</div>

<script src="blogpost.js"></script>